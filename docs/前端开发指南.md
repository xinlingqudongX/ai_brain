# 前端开发指南

## 项目概述

CIIA 智能交互控制台前端项目，基于 Vue 3 + TypeScript + Tailwind CSS 构建。

## 技术栈

- **Vue 3** - 使用 Composition API
- **TypeScript** - 类型安全
- **Vite** - 快速构建工具
- **Tailwind CSS** - 实用优先的 CSS 框架
- **Pinia** - 状态管理
- **Vue Router** - 路由管理
- **Axios** - HTTP 客户端

## 项目结构

```
frontend/
├── src/
│   ├── api/                    # API 接口封装
│   │   └── index.ts            # 所有 API 方法
│   ├── components/             # Vue 组件
│   │   ├── drawer/             # 配置抽屉子组件
│   │   │   ├── RoleSettings.vue
│   │   │   ├── CapabilitySelection.vue
│   │   │   └── EventSubscriptions.vue
│   │   ├── AgentCard.vue       # Agent 卡片
│   │   ├── AppHeader.vue       # 顶部导航
│   │   ├── ConfigDrawer.vue    # 配置抽屉
│   │   └── ExecutionMonitor.vue # 执行监控
│   ├── stores/                 # Pinia 状态管理
│   │   ├── agent.ts            # Agent 状态
│   │   └── capability.ts       # Capability 状态
│   ├── types/                  # TypeScript 类型定义
│   │   └── index.ts            # 所有类型定义
│   ├── views/                  # 页面组件
│   │   └── Dashboard.vue       # 主仪表盘
│   ├── router/                 # 路由配置
│   │   └── index.ts
│   ├── App.vue                 # 根组件
│   ├── main.ts                 # 入口文件
│   └── style.css               # 全局样式
├── index.html
├── vite.config.ts              # Vite 配置
├── tailwind.config.js          # Tailwind 配置
├── tsconfig.json               # TypeScript 配置
└── package.json
```

## 开发流程

### 1. 安装依赖

```bash
cd frontend
npm install
```

### 2. 启动开发服务器

```bash
npm run dev
```

访问 http://localhost:5173

开发服务器会自动代理 `/api` 请求到后端 `http://localhost:3000`

### 3. 构建生产版本

```bash
npm run build
```

构建输出到 `../src/static` 目录，NestJS 会自动提供静态文件服务。

### 4. 完整构建（后端 + 前端）

在项目根目录：

```bash
npm run build:all
```

## 核心功能实现

### 1. 智能体概览 (Agent Grid)

**组件**: `AgentCard.vue`

显示所有 Agent 的卡片列表：
- Agent 名称和图标
- 激活状态（绿色/灰色指示灯）
- 能力数量统计
- 订阅事件数量

**交互**: 点击卡片打开配置抽屉

### 2. 实时执行监控 (Execution Call Stack)

**组件**: `ExecutionMonitor.vue`

流程图样式展示 Agent 执行过程：
- 上下文初始化
- LLM 决策引擎调用
- 能力执行
- 结果输出

**状态反馈**:
- 成功: 绿色
- 失败: 红色
- 处理中: 黄色

### 3. 统一配置抽屉 (Config Drawer)

**主组件**: `ConfigDrawer.vue`

三栏布局，对应 Who → What → When 的配置流程：

#### 栏目一：角色设定 (RoleSettings.vue)
- Agent 名称、描述、目标
- 人设 Prompt 编辑
- 最终 Prompt 预览（动态组合）

#### 栏目二：能力装配 (CapabilitySelection.vue)
- 分类标签页（核心、DevOps、数据、生活）
- 搜索功能
- 多选能力授权
- 支持大量能力的可扩展设计

#### 栏目三：事件订阅 (EventSubscriptions.vue)
- 时间轴样式展示订阅的事件
- 添加/删除事件订阅
- 快速添加常用事件
- 事件建议列表

## API 集成

### API 封装

所有 API 调用封装在 `src/api/index.ts`：

```typescript
import { agentsApi, rolesApi, capabilitiesApi, timelineApi } from './api';

// 使用示例
const response = await agentsApi.list({ page: 1, limit: 10 });
const agent = await agentsApi.get(id);
await agentsApi.create(data);
await agentsApi.update(id, data);
await agentsApi.delete(id);
```

### API 端点

所有 API 使用 POST 请求：

- **Agents**: `/api/v1/agents/action/*`
  - `create`, `list`, `get`, `update`, `delete`, `execute`

- **Roles**: `/api/v1/roles/action/*`
  - `create`, `list`, `get`, `update`, `delete`

- **Capabilities**: `/api/v1/capabilities/action/*`
  - `create`, `list`, `get`, `update`, `delete`

- **Timeline**: `/api/v1/timeline/action/*`
  - `create`, `list`, `get`, `update`, `delete`, `trigger`

## 状态管理

### Agent Store

```typescript
import { useAgentStore } from '@/stores/agent';

const agentStore = useAgentStore();

// 获取 Agent 列表
await agentStore.fetchAgents();

// 获取单个 Agent
await agentStore.fetchAgent(id);

// 创建 Agent
await agentStore.createAgent(data);

// 更新 Agent
await agentStore.updateAgent(id, data);

// 删除 Agent
await agentStore.deleteAgent(id);
```

### Capability Store

```typescript
import { useCapabilityStore } from '@/stores/capability';

const capabilityStore = useCapabilityStore();

// 获取所有能力
await capabilityStore.fetchCapabilities();
```

## 设计规范

### 配色方案

```css
/* 主背景 */
.bg-main { background-color: #111827; }

/* 卡片背景 */
.bg-card { background-color: #1f2937; }

/* 强调色 */
.text-accent { color: #3b82f6; }

/* 状态色 */
.text-green-400  /* 成功 */
.text-red-400    /* 错误 */
.text-yellow-400 /* 警告 */
```

### 组件规范

1. **使用 Composition API**
   ```vue
   <script setup lang="ts">
   import { ref, computed } from 'vue';
   </script>
   ```

2. **TypeScript 类型安全**
   ```typescript
   defineProps<{
     agent: Agent;
   }>();
   ```

3. **响应式设计**
   ```html
   <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
   ```

4. **暗黑主题**
   - 所有组件使用暗色背景
   - 文字使用灰色系
   - 强调元素使用蓝色

### 动画效果

```css
/* 抽屉滑入/滑出 */
.drawer-enter-active,
.drawer-leave-active {
  transition: transform 0.3s ease-in-out;
}

/* 淡入/淡出 */
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s ease;
}
```

## 开发技巧

### 1. 热重载

Vite 提供快速的热模块替换（HMR），修改代码后浏览器会自动更新。

### 2. TypeScript 类型检查

```bash
# 类型检查
npx vue-tsc --noEmit
```

### 3. 调试

使用 Vue DevTools 浏览器扩展进行调试：
- 查看组件树
- 检查 Pinia 状态
- 追踪事件

### 4. API 代理

开发环境下，Vite 会自动代理 API 请求：

```typescript
// vite.config.ts
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true,
    },
  },
}
```

## 常见问题

### 1. API 请求失败

确保后端服务已启动：
```bash
npm run start:dev
```

### 2. 样式不生效

检查 Tailwind CSS 配置：
```bash
# 重新构建
npm run build
```

### 3. 类型错误

更新类型定义：
```typescript
// src/types/index.ts
export interface Agent {
  // 添加新字段
}
```

## 部署

### 开发环境

```bash
# 后端
npm run start:dev

# 前端（新终端）
cd frontend
npm run dev
```

访问 http://localhost:5173

### 生产环境

```bash
# 构建前端
npm run build:frontend

# 构建后端
npm run build

# 启动
npm run start:prod
```

访问 http://localhost:3000

## 扩展开发

### 添加新组件

1. 在 `src/components` 创建组件文件
2. 使用 TypeScript 和 Composition API
3. 遵循设计规范
4. 添加必要的类型定义

### 添加新 API

1. 在 `src/types/index.ts` 添加类型定义
2. 在 `src/api/index.ts` 添加 API 方法
3. 在组件中使用

### 添加新页面

1. 在 `src/views` 创建页面组件
2. 在 `src/router/index.ts` 添加路由
3. 更新导航

## 参考资源

- [Vue 3 文档](https://cn.vuejs.org/)
- [TypeScript 文档](https://www.typescriptlang.org/)
- [Tailwind CSS 文档](https://tailwindcss.com/)
- [Vite 文档](https://cn.vitejs.dev/)
- [Pinia 文档](https://pinia.vuejs.org/zh/)
